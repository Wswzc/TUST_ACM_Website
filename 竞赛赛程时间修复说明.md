# 竞赛赛程时间修复说明

## 🔍 问题描述

用户反馈：**"比赛赛程页面的时间好像不对"**

## 🐛 发现的问题

### 1. 时间计算不准确
**问题**：
- 使用简单的时间偏移（`now.getTime() + X天`）
- 没有设置具体的小时和分钟
- 导致比赛时间显示为当前时刻 + X天，而不是实际的比赛时间

**示例**：
```javascript
// 修复前 - 错误的方式
startTime: new Date(now.getTime() + 2 * 24 * 60 * 60 * 1000)
// 如果现在是 14:30，则显示为 2天后的 14:30

// 修复后 - 正确的方式
const contest = new Date(now);
contest.setDate(now.getDate() + 2);
contest.setHours(22, 35, 0, 0);
// 显示为 2天后的 22:35
```

### 2. 缺少时区信息
**问题**：
- 时间显示没有标注时区
- 用户可能不清楚是北京时间还是其他时区

### 3. LeetCode 周赛时间计算错误
**问题**：
- 周日计算逻辑有误
- 双周赛时间计算复杂且不准确

## ✅ 修复内容

### 1. Codeforces 比赛时间
```javascript
// 修复后：设置为晚上 22:35 或 23:35 (北京时间)
const contest1 = new Date(now);
contest1.setDate(now.getDate() + 2);
contest1.setHours(22, 35, 0, 0);
```

**实际比赛时间**：
- Codeforces Round: 通常在北京时间晚上 22:35 或 23:35
- Educational Round: 通常在北京时间晚上 23:35
- 时长：2-2.5 小时

### 2. AtCoder 比赛时间
```javascript
// 修复后：设置为周六晚上 20:00 (北京时间)
const nextSaturday = new Date(now);
const daysUntilSaturday = (6 - now.getDay() + 7) % 7 || 7;
nextSaturday.setDate(now.getDate() + daysUntilSaturday);
nextSaturday.setHours(20, 0, 0, 0);
```

**实际比赛时间**：
- ABC (Beginner Contest): 周六晚上 20:00
- ARC (Regular Contest): 周六晚上 20:00
- AGC (Grand Contest): 周六晚上 20:00
- 时长：100-150 分钟

### 3. LeetCode 比赛时间
```javascript
// 修复后：周赛周日 10:30，双周赛周六 22:30
const nextSunday = new Date(now);
const daysUntilSunday = (7 - now.getDay()) % 7 || 7;
nextSunday.setDate(now.getDate() + daysUntilSunday);
nextSunday.setHours(10, 30, 0, 0);

const nextSaturday = new Date(nextSunday);
nextSaturday.setDate(nextSunday.getDate() - 1);
nextSaturday.setHours(22, 30, 0, 0);
```

**实际比赛时间**：
- 周赛：每周日上午 10:30 (北京时间)
- 双周赛：每两周周六晚上 22:30 (北京时间)
- 时长：90 分钟

### 4. 洛谷比赛时间
```javascript
// 修复后：设置为具体时间
const contest1 = new Date(now);
contest1.setDate(now.getDate() + 3);
contest1.setHours(19, 0, 0, 0);
```

**实际比赛时间**：
- 月赛：通常在周六晚上 19:00
- 模拟赛：周末下午 14:00 或晚上
- 时长：3-4 小时

### 5. 牛客比赛时间
```javascript
// 修复后：设置为晚上 19:00 或 20:00
const contest1 = new Date(now);
contest1.setDate(now.getDate() + 2);
contest1.setHours(19, 0, 0, 0);
```

**实际比赛时间**：
- 小白月赛：周六晚上 19:00
- 周赛：周六晚上 20:00
- 时长：2 小时

### 6. AcWing 比赛时间
```javascript
// 修复后：设置为周六晚上 20:00
const nextSaturday = new Date(now);
const daysUntilSaturday = (6 - now.getDay() + 7) % 7 || 7;
nextSaturday.setDate(now.getDate() + daysUntilSaturday);
nextSaturday.setHours(20, 0, 0, 0);
```

**实际比赛时间**：
- 周赛：周六晚上 20:00
- 时长：90 分钟

### 7. 添加时区信息
```javascript
formatTime(date) {
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    const timezone = 'UTC+8';  // 添加时区标识
    return `${hours}:${minutes} (${timezone})`;
}
```

## 📊 修复前后对比

| 平台 | 修复前 | 修复后 |
|------|--------|--------|
| Codeforces | 当前时间 + 2天 (如 14:30) | 2天后的 22:35 |
| AtCoder | 当前时间 + 1天 | 下周六 20:00 |
| LeetCode | 计算错误 | 周日 10:30 / 周六 22:30 |
| 洛谷 | 当前时间 + 3天 | 3天后的 19:00 |
| 牛客 | 当前时间 + 2天 | 2天后的 19:00 |
| AcWing | 当前时间 + 1天 | 下周六 20:00 |

## 🎯 修复效果

### 修复前 ❌
```
Codeforces Round #920
开始时间: 2025-01-30 14:30
```
（如果当前是 14:30，则显示为 2天后的 14:30，不符合实际）

### 修复后 ✅
```
Codeforces Round #920
开始时间: 2025-01-30 22:35 (UTC+8)
```
（显示为 2天后的 22:35，符合实际比赛时间）

## 🧪 测试验证

### 测试步骤
1. 打开 `src/contests.html`
2. 查看各平台比赛时间
3. 验证时间是否合理：
   - ✅ Codeforces: 晚上 22:35 或 23:35
   - ✅ AtCoder: 周六晚上 20:00
   - ✅ LeetCode: 周日上午 10:30 或周六晚上 22:30
   - ✅ 洛谷: 晚上 19:00
   - ✅ 牛客: 晚上 19:00 或 20:00
   - ✅ AcWing: 周六晚上 20:00
4. 检查是否显示时区信息 (UTC+8)

### 预期结果
- ✅ 所有比赛时间显示为合理的时间点
- ✅ 时间包含时区信息
- ✅ 周赛类比赛显示在正确的星期几
- ✅ 倒计时计算准确

## 📝 技术细节

### 时间设置方法
```javascript
// 正确的方式：使用 setDate 和 setHours
const contest = new Date(now);
contest.setDate(now.getDate() + days);  // 设置日期
contest.setHours(hour, minute, 0, 0);   // 设置具体时间

// 错误的方式：使用时间戳偏移
const contest = new Date(now.getTime() + days * 24 * 60 * 60 * 1000);
// 这会保留当前的小时和分钟
```

### 计算下一个星期X
```javascript
// 计算下一个周六
const nextSaturday = new Date(now);
const daysUntilSaturday = (6 - now.getDay() + 7) % 7 || 7;
nextSaturday.setDate(now.getDate() + daysUntilSaturday);
nextSaturday.setHours(20, 0, 0, 0);

// 说明：
// - 6 是周六的索引 (0=周日, 1=周一, ..., 6=周六)
// - (6 - now.getDay() + 7) % 7 计算距离下周六的天数
// - || 7 确保如果今天是周六，则取下周六
```

## 💡 注意事项

### 1. 模拟数据
当前使用的是模拟数据，实际部署时应该：
- 接入真实的比赛 API
- 使用 Clist API: https://clist.by/api/v2/contest/
- 或各平台的官方 API

### 2. 时区处理
- 所有时间均为北京时间 (UTC+8)
- 如需支持其他时区，需要添加时区转换功能

### 3. 自动更新
- 页面每5分钟自动刷新一次
- 确保比赛信息保持最新

### 4. 真实 API 示例
```javascript
// Codeforces API
fetch('https://codeforces.com/api/contest.list')
    .then(res => res.json())
    .then(data => {
        const contests = data.result.filter(c => c.phase === 'BEFORE');
        // 处理比赛数据
    });

// Clist API (需要 API key)
fetch('https://clist.by/api/v2/contest/?username=YOUR_USERNAME&api_key=YOUR_API_KEY')
    .then(res => res.json())
    .then(data => {
        // 处理比赛数据
    });
```

## ✨ 总结

时间显示问题已完全修复：
- ✅ 所有比赛时间设置为实际的比赛时间点
- ✅ 添加了时区信息 (UTC+8)
- ✅ 周赛类比赛计算到正确的星期几
- ✅ 时间显示更加准确和合理

用户现在可以看到准确的比赛时间，不会再出现时间不对的问题！

---

**修复完成时间**: 2025-01-28  
**状态**: ✅ 完成
